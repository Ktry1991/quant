# 基于Fama-French因子模型的配对交易策略
一、策略简介
1.配对交易
配对交易是一种统计套利策略，利用两只具有长期均衡定价关系的股票的短期价格偏离来进行套利。通过计算两只股票的相关性或者协整关系来找到股票对，本文通过协整检验来选择股票对（具有协整关系的股票对价差是均值回复的），如果两只股票具有长期均衡关系，短期的价差偏离会产生套利机会，当价差低于均衡价差时，买入价格较高的股票，同时卖出价格较高的股票；当价差高于均衡价差时，买入价格较低的股票，同时卖出价格较低的股票。但由于A股市场存在买空限制，所以本策略只进行买入平仓操作。
2.Fama-French五因子模型1993年，Fama和French发表了三因子模型，认为股票的超额收益可以用以下三个因子来解释：市场风险（股票市场的期望超额收益）、市值、账面市值比来解释，随后他们发现除了上述风险，盈利因子和投资水平因子同样可以                                                        带来个股的超额收益，也就是对个股的超额收益具有解释能力。将这两个因子加入到三因子模型中，就有了后来的Fama-French五因子模型，具体表达式如下：

	 是股票的预期超额收益率，是市场风险，是市值因子，是账面市值比因子，是盈利因子，是投资水平因子。
	是指市场整体走势变化所引起的不确定性，是市场带来的风险，不同的股票对市场风险的暴露不同，具体反映在系数上。
	是指公司的规模对该公司股票风险的影响，市值规模小，公司的风险就相对较大，反之，市值规模大，风险就相对较小，所以小市值公司股价预期收益会高于大市值公司股价。该因子的计算方法是小市值股票（市值排序最小的三分之一）平均期望收益率与大市值股票（市值排序最大的三分之一）平均期望收益率的差。
		是账面的所有者权益除以市值(B/M)。账面市值比风险描述了公司额外财务困境风险，B/M大于1，说明市场对公司的估值比公司自己的估值要低，这些公司一般都是销售状况或者盈利能力较差的公司，因此相对于低B/M需要更高的收益来补偿。该因子的计算方法是高B/M（B/M排序最大的三分之一）公司股票预期平均收益率与低B/M（B/M排序最小的三分之一）公司股票预期平均收益率的差。需要指出的是，在本策略中，我们用PB(每股股价除以每股账面价值)作为B/M的倒数来选股，本策略剔除了PB<0的股票。
		是盈利因子，盈利能力水平较高的行业一般会伴随着更高的风险，一般使用ROE(净资产收益率)来计算，计算方法与市值因子相同。
		是投资水平因子，这里的投资水平可以理解为企业扩大再生产的能力，一般认为投资率偏低的公司风险较大，因此需要较高的收益来进行补偿，一般使用总资产年增长率来计算该因子值，总资产年增长率较大的公司，预期具有较高的收益，这里计算方法同市值因子。
3.策略思想
我们认为，同一市场内，能够具有长期均衡关系的股票对必然受相同因素的影响，我们借鉴Fama-French的思路，将其理论中的四个因子作为影响股票价格的重要因素，认为市值，公司估值，盈利水平和投资水平这四个方面相近的股票更有可能存在长期的均衡关系，这里不考虑市场因子是由于市场所有股票都会收到相同的市场因素的影响。我们在每个行业内，分别按照市值，PB(反应公司的估值水平)，ROE,总资产增长率对股票进行分层筛选，选出股票池，此时股票池中有来自各个行业的一对股票对，然后对以上股票对进行协整检验，如果满足协整关系，则作为我们选定的股票对，进行交易。
二、模型介绍
1. 模型假设
在实际的价格波动构成中，训练期内具有协整关系的股票在样本外时间里，往往协整关系就被破坏了，从而造成价差无法在规定时间内收敛或者价差不收敛，并且可能会进一步扩大。因此，我们认为在一段较长时间内具有协整关系的证券可能在之后稍短的时期内，继续维持协整关系。
市值，PB(反应公司的估值水平)，ROE和总资产增长率是影响公司股票价格的主要因素。
2. 模型框架
配对交易策略在实施过程中可以分为以下内容1）股票对的选定； 2）交易信号参数的设定；3）根据交易信号进行交易。





















图1 股票对筛选步骤

3.模型步骤
1）股票对定性与定量筛选
我们对股票组合进行了一系列的定性和定量筛选：1、剔除所有ST和*ST股票；2、提出上市时间未满1年的股票；3、按照申万三级行业分类，按照四因子筛选

























图2 四因子选股的框架

2） 股票对协整检验
上面我们说明了配对交易策略是使用两只具有长期均衡关系的股票对价差短期内偏离均衡关系来进行套利的。那么我们用什么来衡量长期均衡关系是由为重要的。下面我们将介绍能够检验股票对具有长期均衡关系的协整检验。
股票价格序列一般是非平稳的时间序列，但是，当两个非平稳的时间序列之间存在协整关系，所谓两个非平稳时间序列的的协整关系是两个变量的回归后的残差是平稳的时间序列，这里平稳是
假设股票价格序列和股票价格序列的长期均衡关系是：

这里是协整系数，是A股票价格对B股票价格的溢价，是残差序列，若是平稳序列，则这对股票对的价格是具有协整关系，也就是具有长期均衡关系。
我们首先对两只股票价格序列进行回归，得到残差序列；然后对残差序列进行ADF平稳性检验，若残差序列通过平稳性检验，证明了股票对存在长期均衡关系，可以进行配对交易策略；否则不成立。选出N对股票，每一对股票等权重分配初始资金的1/N.
3） 回归两只股票价格计算股票对价差
下面我们将股票池中每一对股票对中股票A的价格与股票B的价格进行回归，目的是算出这两个股票以怎样的线性组合构成平稳序列，计算得到的回归系数，计算价差序列：

		由上面的协整关系可以得知，价差序列是平稳系列，长期会存在均值回复的特征。将价差序列标准化，得到Z-score,具体计算方法为,即将价差减去价差序列的均值除以价差序列的标准差，需要说明的是，价差序列标准化以后不会影响其平稳性。当Z-score大于1，将该股票对的资金全仓买入价格较低的股票B，进行套利；当Z-score小于-1，全仓买入价格较低的股票A；当股票的价格介于-1和1之间，以p，q的比例持有A,B两只股票，在本策略中，p = q = 0.5。
4） 设置交易参数与交易信号
为了在最大程度接近真实的交易情况，我们使用日度数据来进行计算。由于经典的配对交易是通过一买一卖来进行套利的，但是A股市场存在买空限制，所以本策略只进行买入平仓操作：当股票价差向上突破阈值时，此时买入价格比较低的股票，即涨幅较小的股票，等待价差缩小，被低估的股票价格预期会上涨；当股票价差向下突破阈值时，此时买入价格比较低的股票，即跌幅较大的股票，等待价差缩小，同样预期被低估的股票价格会上涨。
我们按照12个月为移动时间窗口，每隔1个月按照申万三级行业和Fama-French四因子筛选股票对，检验每一个行业筛选出的股票对的协整关系，选择协整关系显著的股票对进行交易；每一个月检验一次协整关系，如果协整关系被破坏，将原有的股票对从股票池中剔除，选择新的满足具有强协整关系并且显著的股票对进入股票池，否则继续持有。
		下图是策略的具体流程：

























                          图3 策略流程
	5）止损条件
由于本策略在全行业内选股，所以我们以中证500指数为标准，设置止损线：10日内上证指数跌幅超过k%，选择平仓，这里分别设置参数k=5和8。
三、历史回测结果 
本策略的回测起始时间分别是是2013-01-01和2016-01-01，结束时间2017-11-30，手续费万分之三，印花税千分之四，没有设置滑点。以上回测时间的设置是为了避开2015年股市上涨而后大跌的行情。
策略结果如下：





结果一：策略回测自20130101开始，止损线为中证500指数10日下跌8%

图4 

结果二：策略回测自20130101开始，止损线为中证500指数10日下跌5%


图5

结果三：策略回测自20160101开始，止损线为中证500指数10日下跌8%

图6


结果四：策略回测自20160101开始，止损线为中证500指数10日下跌5%

图7
四、策略评价与改进
1. 策略评价
	横向比较：图4和图5分别将止损线设置为中证500十日跌幅超过8%和5%，当我们加强止损条件后，回撤有了明显的改进，回撤下降了大约三分之一，但是夏普比率和策略年化收益和ALPHA大幅下降，下降幅度大约在50%。图6和图7 的对比中，我们加强了止损条件反而增大了最大回撤，这可能是由于止损限制太强，错过了交易机会，并且加强止损后的收益较差。所以，我们在以后的策略改进中一律使用中证500指数10日跌幅超过8%为止损限制条件。
	纵向比较：图4和图6具有相同的止损限制，但是回测时间不同，2013年开始回测，本策略有正收益，这是由于2015年股市上涨积累导致的，在2015年股市大跌时，由于本策略相比于基准有止损条件，所以2013年的回测中，本策略跑赢基准。2016年回测结果相比如2013年较小，这是由于没有包含2015年所致，同样，我们可以看到2016年的回测结果中，策略同样跑赢基准。
2. 策略改进：
由于存在市值因子轮动，由图6和图7中可以看出，2016年以来，中证500指数收益为负，策略收益虽然优于中证500，但仍然是负收益。我们对模型的四因子选股进行简化，只使用PB因子进行选股，选股逻辑是：选择每个行业PB>0,并且具有最小PB的两只股票构成股票对，然后对每个行业的股票对进行协整检验，通过检验的股票对进行交易。策略的其他参数与四因子选股参数设置相同，止损条件为为中证500指数10日下跌8%。
模型改进结果见图8和图9，改进后的模型相比于基准具有绝对的正收益。


结果五：策略回测自20160101开始，止损线为中证500指数10日下跌8%

图8

	结果六策略回测自20130101开始，止损线为中证500指数10日下跌8%

图9
3.策略展望
由于卖空限制，本策略并不是完全意义的配对策略，我们在本策略中只对但是股票进行买入操作，没有对另一只进行卖空来对冲风险，所以在策略的beta不为0。改进方法：考虑使用股指期货进行对冲，由于时间限制，我们对股指期货的对冲比例等参数的设置缺乏更为具体的了解，所以这一部分没有在策略中实现，可以作为将来策略改进的方向。
